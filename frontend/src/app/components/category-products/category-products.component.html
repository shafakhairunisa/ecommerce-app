<div class="container mt-5">
  <h2>{{ formatCategoryName(category || 'All') }} Products</h2>

  <!-- Loading spinner -->
  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Product grid -->
  <div class="row g-4" *ngIf="!isLoading">
    <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let product of filteredProducts; trackBy: trackByProductId">
      <div class="card product-card h-100 text-center">
        <img [src]="product.imageUrl"
             (error)="product.imageUrl = 'assets/images/placeholder.jpg'"
             class="card-img-top"
             alt="{{ product.name }}"
             (click)="showProductDetails(product)"
             style="cursor: pointer;">

        <div class="card-body">
          <h5 class="product-name">{{ product.name }}</h5>
          <p class="category">Category: {{ product.category.name }}</p>
          <p class="product-price">RM {{ product.price.toFixed(2) }}</p>
          <p [ngClass]="{'text-success': product.available, 'text-danger': !product.available}">
            {{ product.available ? 'In Stock' : 'Out of Stock' }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for product details -->
<div class="modal" *ngIf="selectedProduct" style="display: block; background: rgba(0,0,0,0.5); position: fixed; top: 0; left: 0; width: 100%; height: 100%;">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="max-width: 90%;">
      <div class="modal-header">
        <h5 class="modal-title">{{ selectedProduct.name }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body text-center">
        <img [src]="selectedProduct.imageUrl"
             (error)="selectedProduct.imageUrl = 'assets/images/placeholder.jpg'"
             alt="{{ selectedProduct.name }}"
             style="max-width: 100%; height: auto;">
        <p class="product-price mt-3">RM {{ selectedProduct.price.toFixed(2) }}</p>
        <p class="availability" [ngClass]="{'text-success': selectedProduct.available, 'text-danger': !selectedProduct.available}">
          {{ selectedProduct.available ? 'In Stock' : 'Out of Stock' }}
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button type="button" class="btn btn-success" (click)="addToCart(selectedProduct)" [disabled]="!selectedProduct.available">
          Add to Cart
        </button>
      </div>
    </div>
  </div>
</div>
