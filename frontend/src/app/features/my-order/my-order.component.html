<div class="orders-container">
  <!-- Use the shared header component -->
  <app-customer-header [cartCount]="0"></app-customer-header>

  <div class="page-title">
    <h1><i class="bi bi-box-seam"></i> Your Orders</h1>
  </div>

  <!-- Alert Messages -->
  <div class="alert alert-danger" *ngIf="error">
    {{ error }}
    <button class="retry-button" (click)="loadOrders()">Retry</button>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading your orders...</p>
  </div>

  <!-- Orders List -->
  <div class="orders-content" *ngIf="!loading">
    <div class="no-orders" *ngIf="orders.length === 0">
      <div class="no-orders-message">
        <i class="bi bi-bag-x"></i>
        <h2>No orders found</h2>
        <p>You haven't placed any orders yet.</p>
        <button class="shop-now" [routerLink]="['/customer/dashboard']">Shop Now</button>
      </div>
    </div>

    <div class="orders-list" *ngIf="orders.length > 0">
      <div class="order-card" *ngFor="let order of orders">
        <div class="order-header">
          <div>
            <h3>Order #{{ order.orderId || 'N/A' }}</h3>
            <p class="order-date">{{ formatDate(order.orderDate) }}</p>
          </div>
          <div class="order-status" [ngClass]="getOrderStatusClass(order.status)">
            {{ order.status || 'Processing' }}
          </div>
        </div>
        
        <div class="order-summary">
          <div class="order-total">
            <span>Total:</span>
            <span>RM {{ order.totalAmount ? order.totalAmount.toFixed(2) : '0.00' }}</span>
          </div>
          <div class="order-items-count">
            <span>Items:</span>
            <span>{{ order.items && order.items.length || 0 }}</span>
          </div>
        </div>
        
        <div class="order-actions">
          <button class="view-details" (click)="viewOrderDetails(order.orderId || 0)">
            View Details
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div class="modal" *ngIf="selectedOrder">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Order #{{ selectedOrder.orderId || 'N/A' }}</h2>
        <span class="close" (click)="closeOrderDetails()">&times;</span>
      </div>
      
      <div class="order-info">
        <div class="order-info-item">
          <span>Order Date:</span>
          <span>{{ formatDate(selectedOrder.orderDate) }}</span>
        </div>
        <div class="order-info-item">
          <span>Status:</span>
          <span [ngClass]="getOrderStatusClass(selectedOrder.status)">{{ selectedOrder.status || 'Processing' }}</span>
        </div>
        <div class="order-info-item">
          <span>Total:</span>
          <span>RM {{ selectedOrder.totalAmount ? selectedOrder.totalAmount.toFixed(2) : '0.00' }}</span>
        </div>
      </div>
      
      <div class="order-items">
        <h3>Items</h3>
        <div *ngIf="selectedOrder.items?.length === 0" class="no-items">
          <p>No items found in this order.</p>
        </div>
        <div class="order-item" *ngFor="let item of selectedOrder.items || []">
          <div class="item-image">
            <img [src]="getProductImagePath(item.product?.category || '', item.product?.name || '', item.product?.imagePath)" alt="{{ item.product?.name || 'Product' }}">
          </div>
          <div class="item-details">
            <h4>{{ item.product?.name || 'Unknown Product' }}</h4>
            <p class="item-category">{{ item.product?.category || 'Uncategorized' }}</p>
          </div>
          <div class="item-price">
            <p>RM {{ item.price ? item.price.toFixed(2) : '0.00' }} x {{ item.quantity || 0 }}</p>
            <p class="item-subtotal">RM {{ ((item.price || 0) * (item.quantity || 0)).toFixed(2) }}</p>
          </div>
        </div>
      </div>
      
      <div class="order-totals">
        <div class="total-item">
          <span>Subtotal:</span>
          <span>RM {{ selectedOrder.totalAmount ? selectedOrder.totalAmount.toFixed(2) : '0.00' }}</span>
        </div>
        <div class="total-item">
          <span>Shipping:</span>
          <span>Free</span>
        </div>
        <div class="total-item total">
          <span>Total:</span>
          <span>RM {{ selectedOrder.totalAmount ? selectedOrder.totalAmount.toFixed(2) : '0.00' }}</span>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="close-button" (click)="closeOrderDetails()">Close</button>
      </div>
    </div>
  </div>
</div> 